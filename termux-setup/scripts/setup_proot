#!/bin/bash

function failed
{
    echo "Failed. Aborting."
    exit 1
}


PROOT_DISTRO="debian"
PROOT_PATH="$PREFIX/var/lib/proot-distro/installed-rootfs/${PROOT_DISTRO}"
SCRIPTS=$HOME/scripts




if [ -f "$HOME/.proot_ready" ];
then
    echo "Proot distro already setup."
    echo ""
    exit 0
fi


if ! [ -d "$PROOT_PATH" ];
then
    if ! [ -f "${PREFIX}/bin/proot-distro" ];
    then
        echo "- Installing proot-distro ..."
        
        pkg update
        pkg install -y proot-distro

        if ! [ "$?" == "0" ];
        then
            failed
        fi
    fi


    echo "- Installing ${PROOT_DISTRO} ..."
    proot-distro install ${PROOT_DISTRO}

    if ! [ "$?" == "0" ];
    then
        failed
    fi


    echo "- Preparing ${PROOT_DISTRO} ..."

    echo "-- Installing packages ..."

    $SCRIPTS/prun_admin apt-get update
    $SCRIPTS/prun_admin apt-get install -y screen wget
    $SCRIPTS/prun_admin useradd --create-home --shell /bin/bash puser

    if ! [ "$?" == "0" ];
    then
        failed
    fi

    echo "-- Installing scripts ..."

    mkdir -p "$PROOT_PATH/root/scripts"

    cp "$SCRIPTS/enable_x11" "$PROOT_PATH/root/scripts"
    cp "$SCRIPTS/install_box86_64" "$PROOT_PATH/root/scripts"
    cp "$SCRIPTS/install_wine" "$PROOT_PATH/root/scripts"


    echo "Finished."
    touch "$HOME/.proot_ready"
fi

